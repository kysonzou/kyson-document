---
category:
  - Tech
tags:
  - Linux
  - MacOS
status: Done
---
- shell是个程序，这个程序的作用就是接收终端的命令行指令，并且让计算机执行指令并把结果返回给终端
- shell程序自己支持的命令不多，但是它可以调用其它的程序，所以可以通过扩展安装各种各样的命令行程序，然后通过终端发送命令给shell，让shell去调用它们
- shell也是一种编程语言（脚本语言），支持编程，这个时候的sell程序就是个解释器，负责解释shell语言编写的程序

### 什么是 Shell

大家都知道，操作系统有一个叫做 **内核** (Kernel) 的东西，它管理着整台计算机的硬件，是现代操作系统中最基本的部分。但是，内核处于系统的底层，是不能让普通用户随意操作的，不然一个不小心系统就崩溃啦！

但我们总还是要让用户操作系统的，怎么办呢？这就需要一个专门的程序，它接受用户输入的命令，然后帮我们与内核沟通，最后让内核完成我们的任务。这个提供用户界面的程序被叫做 **Shell** (壳层)。

>其实 Shell 只是提供了一个用户操作系统的入口，我们一般是通过 Shell 去调用其他各种各样的应用程序，最后来达成我们的目的。比如说我们想要知道一个文件的内容，我们会在 Shell 中输入命令<font color = "red"> `cat foo.txt`</font>，然后 Shell 会帮我们运行 <font color = "red">`cat` </font>这个程序，<font color = "red">`cat`</font>再去调用内核提供的 <font color = "red">`open`</font> 等系统调用来获取文件的内容。虽然并不是 Shell 直接去与内核交互，但广义上可以认为是 Shell 提供了与内核交互的用户界面。

至于为什么叫做 Shell，看下图就知道啦。是不是很像一层壳呢？![Sell(壳层)](../assets/CLI程序-Shell介绍-Sell(壳层).png)

Shell 通常可以分为两种：**命令行 Shell** 与 **图形 Shell**。顾名思义，前者提供一个在命令行界面 (CLI)使用的程序，后者提供一个图形用户界面 (GUI)使用的程序。Windows 下的 `explorer.exe` 就是一个典型的图形 Shell（没错，它确实是，因为它接受来自你的指令，并且会帮你与内核交互完成你的指令）

常见或历史上知名的命令行 Shell 有：

- 适用于 Unix 及类 Unix 系统：
  - **sh** (Bourne shell)，最经典的 Unix shell；
  - **bash** (Bourne-Again shell)，目前绝大多数 Linux 发行版的默认 shell；
  - **zsh** (Z shell)，我个人最喜欢的 shell；
  - **fish** (Friendly interactive shell)，专注于易用性与友好用户体验的 shell；
- Windows 下的 **cmd.exe** (命令提示符) 与 **PowerShell**。

### Shell 如何执行命令行

Shell 程序本身的功能是很弱的，比如文件操作、输入输出、进程管理等都得依赖内核。我们运行一个命令，大部分情况下 Shell 都会去调用内核暴露出来的接口，这就是在使用内核，只是这个过程被 Shell 隐藏了起来，它自己在背后默默进行，我们看不到而已。

接口其实就是一个一个的函数，使用内核就是调用这些函数。除了函数，你没有别的途径使用内核。

Shell 本身支持的命令并不多，功能也有限，但是 Shell 可以调用其他的程序，每个程序就是一个命令，这使得 Shell 命令的数量可以**无限扩展**。

更加惊讶的是，Shell 还可以让多个外部程序发生连接，在它们之间很方便地传递数据，也就是把一个程序的输出结果传递给另一个程序作为输入。

大家所说的 Shell 强大，并不是 Shell 本身功能丰富，而是它擅长使用和组织其他的程序。Shell 就是一个领导者，这正是 Shell 的魅力所在。

可以将 Shell 在整个 Linux 系统中的地位描述成下图所示的样子。注意“用户”和“其它应用程序”是通过虚线连接的，因为用户启动 Linux 后直接面对的是 Shell，通过 Shell 才能运行其它的应用程序。

![Shell执行命令行](../assets/CLI程序-Shell介绍-Shell执行命令行.gif)

### Shell 也支持编程

Shell 并不是简单的堆砌命令，我们还可以在 Shell 中编程，这和使用 C++、C#、Java、Python 等常见的编程语言并没有什么两样。

Shell 虽然没有 C++、Java、Python 等强大，但也支持了基本的编程元素，例如：

- if...else 选择结构，case...in 开关语句，for、while、until 循环；
- 变量、数组、字符串、注释、加减乘除、逻辑运算等概念；
- 函数，包括用户自定义的函数和内置函数（例如 printf、export、eval 等）。

站在这个角度讲，Shell 也是一种编程语言，它的解释器是 Shell 这个程序。我们平时所说的 Shell，有时候是指连接用户和内核的这个程序，有时候又是指 Shell 编程。

Shell 主要用来开发一些实用的、自动化的小工具，而不是用来开发具有复杂业务逻辑的中大型软件。

### Shell 是一种脚本语言

任何代码最终都要被“翻译”成二进制的形式才能在计算机中执行。

有的编程语言，如 C/C++、Pascal、Go语言、汇编等，必须在程序运行之前将所有代码都翻译成二进制形式，也就是生成可执行文件，用户拿到的是最终生成的可执行文件，看不到源码。

这个过程叫做编译（Compile），这样的编程语言叫做$\textcolor{Green}{编译型语言}$，完成编译过程的软件叫做$\textcolor{Green}{编译器}$（Compiler）。

而有的编程语言，如 Shell、JavaScript、Python、PHP等，需要一边执行一边翻译，不会生成任何可执行文件，用户必须拿到源码才能运行程序。程序运行后会即时翻译，翻译完一部分执行一部分，不用等到所有代码都翻译完。

这个过程叫做解释，这样的编程语言叫做$\textcolor{Green}{解释型语言}$或者$\textcolor{Green}{脚本语言}$（Script），完成解释过程的软件叫做$\textcolor{Green}{解释器}$。

编译型语言的优点是执行速度快、对硬件要求低、保密性好，适合开发操作系统、大型应用程序、数据库等。

脚本语言的优点是使用灵活、部署容易、跨平台性好，非常适合 Web 开发以及小工具的制作。

Shell 就是一种脚本语言，我们编写完源码后不用编译，直接运行源码即可。

### Shell和终端的分工

终端干的活儿是从用户这里接收输入（键盘、鼠标等输入设备），扔给 Shell，然后把 Shell 返回的结果展示给用户（比如通过显示器）。而 Shell 干的活儿是从终端那里拿到用户输入的命令，解析后交给操作系统内核去执行，并把执行结果返回给终端。

- 除非被重定向，否则 Shell 永远不会知道它所执行命令的输出结果。我们可以在终端窗口中上下翻页查看过去的输出内容，这完全是终端提供的 feature，与 Shell 没有半毛钱关系；
- 命令提示符 (Prompt) 是一个完全的 Shell 概念，与终端无关；
- 行编辑、输入历史与自动补全等功能是由 Shell 提供的（比如 fish 这个 Shell 就有着很好用的历史命令与命令自动补全功能）。不过终端也能自己实现这些功能，比如说 XShell 这个终端模拟器就可以在本地写完一行命令，然后整条发送给远程服务器中的 Shell（在连接状况不佳时很有用，不然打个字都要卡半天）；
- 终端中的复制粘贴功能（Shift + Insert 或者鼠标右键等）基本上都是由终端提供的。举个例子，Windows 默认的终端对于复制粘贴的支持很屎，而换一个终端（例如 `ConEmu`）后就可以很好地支持复制粘贴。不过 Shell 以及其他命令行程序也可以提供自己的复制粘贴机制（例如 vim）。

- [[Shell重定向&管道]]
### 参考
- [终端、控制器、CLI、shell的区别](https://www.cnblogs.com/chenyang18/p/14335926.html) 
- [1分钟理解Shell的概念](http://c.biancheng.net/view/706.html)

